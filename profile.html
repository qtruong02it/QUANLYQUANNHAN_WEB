<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>H·ªì s∆° qu√¢n nh√¢n</title>
    <link rel="stylesheet" href="css/profile.css">
</head>

<body>
    <button onclick="location.href='index.html'">‚Üê Tr·ªü v·ªÅ</button>
    <div id="profile"></div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwuKHqhAGHcE33BgUZjb9M__LoasY4upbVLeaGAp9kB_Os717YkV1QbGiv-G6yCzlPPUg/exec";
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");
        const profileDiv = document.getElementById("profile");

        if (!id) {
            profileDiv.innerHTML = "<p>‚ùå Thi·∫øu m√£ qu√¢n nh√¢n!</p>";
        } else {
            const CORRECT_PASSWORD = "080304";
            const inputPass = prompt("üîí Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ xem h·ªì s∆°:");
            if (inputPass !== CORRECT_PASSWORD) {
                profileDiv.innerHTML = "<p style='color:red;font-weight:bold;'>‚ùå M·∫≠t kh·∫©u sai! Kh√¥ng th·ªÉ xem h·ªì s∆°.</p>";
            } else {
                fetch(API_URL)
                    .then(res => res.json())
                    .then(data => {
                        const qn = data.find(x => x.MaQN === id);
                        if (!qn) return profileDiv.innerHTML = "<p>Kh√¥ng t√¨m th·∫•y h·ªì s∆° qu√¢n nh√¢n.</p>";

                        const formatDate = (dateStr) => {
                            if (!dateStr) return "";
                            return new Date(dateStr).toLocaleDateString("vi-VN", {
                                timeZone: "Asia/Ho_Chi_Minh",
                                day: "2-digit",
                                month: "2-digit",
                                year: "numeric"
                            });
                        };

                        // ·∫¢nh m·∫∑c ƒë·ªãnh
                        const avatar = qn.HinhAnh?.[0]?.URLAnh || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
                        const cover = "https://images.unsplash.com/photo-1527980965255-d3b416303d12?w=1200&q=80";

                        // Render giao di·ªán
                        const html = `
              <div class="cover-photo">
                <img src="${cover}" alt="·∫¢nh b√¨a">
                <div class="avatar"><img src="${avatar}" alt="·∫¢nh ƒë·∫°i di·ªán"></div>
              </div>

              <div class="profile-header">
                <h1>${qn.HoTen || "Kh√¥ng r√µ t√™n"}</h1>
                <p>${qn.ChucVu || ""} ‚Ä¢ ${qn.DonVi || ""}</p>
              </div>

              <div class="profile-body">
                <!-- C·ªôt tr√°i -->
                <div class="profile-sidebar">
                  <h2>Gi·ªõi thi·ªáu</h2>
                  <p><strong>M√£:</strong> ${qn.MaQN || ""}</p>
                  <p><strong>Ng√†y sinh:</strong> ${formatDate(qn.NgaySinh)}</p>
                  <p><strong>Qu√™ qu√°n:</strong> ${qn.QueQuan || ""}</p>
                  <p><strong>R√®n luy·ªán:</strong> ${qn.THRenLuyen || ""}</p>
                </div>

                <!-- C·ªôt ph·∫£i -->
                <div class="profile-content">
                  <h2>Nh·∫≠n x√©t</h2>
                  ${(qn.NhanXet || [])
                                .map(n => {
                                    const ngay = formatDate(n.NgayDanhGia);
                                    const noiDung = n.NoiDungNX || n.NgNhanXet || "Kh√¥ng c√≥ nh·∫≠n x√©t";
                                    return `
                        <div class="post">
                          <div class="post-header">
                            <img class="post-avatar" src="${avatar}" alt="avatar">
                            <div>
                              <h3>${qn.HoTen}</h3>
                              <span>${ngay}</span>
                            </div>
                          </div>
                          <div class="post-content">${noiDung}</div>
                        </div>`;
                                })
                                .join("")}
                  
                  <h2>H√¨nh ·∫£nh</h2>
                  <div class="images">
                    ${(qn.HinhAnh || [])
                                .map(h => `<img src="${h.URLAnh}" alt="H√¨nh qu√¢n nh√¢n">`)
                                .join("")}
                  </div>
                </div>
              </div>
            `;
                        profileDiv.innerHTML = html;
                    })
                    .catch(err => profileDiv.innerHTML = `<p style='color:red;'>L·ªói t·∫£i d·ªØ li·ªáu: ${err}</p>`);
            }
        }
    </script>
</body>

</html>
